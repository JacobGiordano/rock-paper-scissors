<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="">
  <title>Rock, Paper, Scissors</title>
</head>
<body>
  <h1 class="page-title">Rock, Paper, Scissors</h1>
  <h2 id="round-counter"></h2>
  <label for="num-of-rounds">
    <input id="num-of-rounds" type="number" value=1 name="num-of-rounds" />
  </label>
  <div class="container">
    <button id="btn-rock" class="option-button">Rock</button>
    <button id="btn-paper" class="option-button">Paper</button>
    <button id="btn-scissors" class="option-button">Scissors</button>
  </div>
  <div id="final-scores"></div>
  <div id="results"></div>
</body>
<script>
  const optionButtons = document.querySelectorAll(".option-button");
  optionButtons.forEach(button => button.addEventListener("click", handleOptionButtonClick))

  function computerPlay() {
    const options = ["rock", "paper", "scissors"];
    let index = Math.floor(Math.random() * Math.floor(options.length));
    return options[index];
  }

  function handleOptionButtonClick(e) {
    let result;
    const computerSelection = computerPlay();
    if (e.target.id === "btn-rock") {
      result = playRound("rock", computerSelection);
    } else if (e.target.id === "btn-paper") {
      result = playRound("paper", computerSelection);
    } else if (e.target.id === "btn-scissors") {
      result = playRound("scissors", computerSelection);
    }
    
    updateGameState(result);
    displayMessages(result);
  }

  function displayMessages(result) {
    let gameData = window.gameData;

    if (document.getElementById("results").textContent == "") {
      document.getElementById("results").textContent = `ROUND ${window.gameData.playedRounds} ${result.msg}`;
    } else {
      document.getElementById("results").textContent = `ROUND ${window.gameData.playedRounds} ${result.msg} \n` + document.getElementById("results").textContent;
    }
    console.log(result);

    if (gameData.playedRounds === gameData.totalRounds) {
      console.log(`### ========================================== ###
You won: ${gameData.numOfPlayerWins} ${gameData.numOfPlayerWins > 1 ? "rounds" : "round"}
The computer won: ${gameData.numOfComputerWins} ${gameData.numOfComputerWins > 1 ? "rounds" : "round"}
And there ${gameData.numOfTies > 1 ? "were" : "was"} ${gameData.numOfTies} ${gameData.numOfTies > 1 ? "ties" : "tie"}`);
      if (gameData.numOfPlayerWins > gameData.numOfComputerWins) {
        console.log("Making *YOU* The Winner! Way to go! 🎉");
      } else if (gameData.numOfPlayerWins < gameData.numOfComputerWins) {
        console.log("The computer is the winner. Better luck next time. 👾");
      } else if (gameData.numOfPlayerWins === gameData.numOfComputerWins) {
        console.log("INCREDIBLE! It's a TIE! Well done to you *and* the computer! 👤🤝🖥");
      }
      console.log("### ========================================== ###");
    }
  }

  function playRound(playerSelection, computerSelection) {
    let roundData = {};
    if (playerSelection === null) {
      roundData.msg = "Error. Play selection is null.";
    } else {
      playerSelection = playerSelection.toLowerCase();
    }
    computerSelection = computerSelection.toLowerCase();
    roundData.playerWon = false;
    if (playerSelection === "rock" && computerSelection === "paper") {
      roundData.playerWon = true;
    } else if (playerSelection === "paper" && computerSelection === "rock") {
      roundData.playerWon = true;
    } else if (playerSelection === "scissors" && computerSelection === "paper") {
      roundData.playerWon = true;
    } else if (playerSelection === computerSelection) {
      roundData.playerWon = "tie";
      roundData.msg = `IT'S A TIE! ${playerSelection} ${playerSelection === "scissors" ? "are" : "is"} equal to ${computerSelection}`;
      return roundData;
    }
    roundData.msg = `${roundData.playerWon ? `YOU WIN! ${playerSelection} ${playerSelection === "scissors" ? "beat" : "beats"} ${computerSelection}` : `YOU LOSE! ${computerSelection} ${computerSelection === "scissors" ? "beat" : "beats"} ${playerSelection}`}`;
    return roundData;
  }

  function updateGameState(roundResult) {
    let result = roundResult.playerWon;
    let gameData = window.gameData;
    let numOfPlayerWins;
    let numOfComputerWins;
    let numOfTies;
    let totalRounds;
    let playedRounds;

    if (gameData === undefined) {
      window.gameData = {
        numOfPlayerWins: 0,
        numOfComputerWins: 0,
        numOfTies: 0,
        playedRounds: 0,
        totalRounds: Number(document.getElementById("num-of-rounds").value)
      }
    }
    gameData = window.gameData;

    if (gameData.playedRounds < gameData.totalRounds) {
      if (result === "tie") {
        gameData.numOfTies++;
      } else if (result) {
        gameData.numOfPlayerWins++;
      } else if (!result) {
        gameData.numOfComputerWins++;
      }
      gameData.playedRounds++;
    }
  }
</script>
</html>